# 智能家居系统项目

本项目由四个模块组成，涵盖前端（uni-app）、后端（Java Spring Boot）、嵌入式设备（ESP32）与调试辅助工具（Python MQTT 模拟器），共同构建了一个完整的智能家居控制与展示系统。

---

## 📦 项目模块说明

### 1. Java 后端服务（`/backend-java`）
- 使用 Spring Boot + JPA + Redis 实现权限控制、设备管理与自动化处理。
- 接入 Ollama 本地大模型，实现自然语言场景控制。
- 集成 MQTT 接收设备状态、发送控制命令。
- 使用 AOP + 拦截器 + 自定义注解保障 API 安全性。

#### 📘 后端接口返回码说明

所有接口统一返回结构如下：

```json
{
  "code": 0,
  "message": "success",
  "data": {...}
}
```

##### 返回码定义表：

| Code | 含义说明             |
|------|----------------------|
| 0    | ✅ 成功              |
| 1    | ❌ 非法请求（签名错误、时间戳非法等） |
| 2    | ❌ 参数错误（缺少字段、格式不合法）   |
| 3    | ❌ 用户问题（用户不存在、登录失败等） |
| 4    | ❌ 权限问题（无权访问资源）          |
| 401  | ❌ 未登录 / Token 失效（权限问题特殊变体） |
| 5    | ❌ 设备相关错误（设备不存在、绑定失败等） |
| 6    | ❌ 房间相关错误（房间不存在、操作失败） |
| 7    | ❌ 家庭组相关错误（加入失败、权限异常） |
| 100  | ❌ 其他未知错误（系统内部异常等）     |

**运行环境要求：**
- Java 17+
- MySQL 8.0+（需手动创建数据库）
  - 数据库名：`home`
  - 字符集：`utf8mb4`
- Redis
- Ollama

📄 详见 `/backend-java/MQTT_README.md`，介绍 MQTT 接口的状态上报、控制下发、告警等协议格式。

---

### 2. Uni-app 前端应用（`/frontend-uniapp`）
- 实现跨平台 H5 / Android / iOS 的智能家居控制面板。
- 包含设备扫码添加、控制页面、自动化设置、家庭组管理等功能。
- 使用自带组件构建，体积小，样式统一，支持毛玻璃等美观特性。

**配置要求：**
- 仅需修改 `BASE_URL` 为后端接口地址，其余可直接运行。

---

### 3. ESP32 智能设备程序（`/device-esp32`）
- 使用 ESP-IDF 开发，支持 SmartConfig 智能配网、NVS 本地存储。
- 设备包括：蜂鸣器、霍尔传感器、温湿度传感器、继电器、灯光控制等。
- 可推送状态与告警至后端系统。

**运行说明：**
- 项目已配置完成，可直接构建烧录至 ESP32。
- 引脚定义详见 `引脚定义.yml`。

---

### 4. Python MQTT 模拟器（`/mqtt-simulator`）
- 用于模拟多台虚拟设备，协助演示与调试。
- 支持周期性心跳发送、响应控制指令、状态展示 GUI。
- 使用 `Tkinter` 编写图形界面。

**运行环境：**
- Python 3.7+
- 安装依赖：
  ```bash
  pip install paho-mqtt
  ```

📄 使用说明见 `/mqtt-simulator/GUI_README.md`

---

## 📁 附加资源文件说明

| 文件 / 文件夹 | 说明 |
|---------------|------|
| `qr-code/` | 设备二维码（用于扫码配对） |
| `API.postman_collection.json` | Postman API 定义集合 |
| `esp-pin.yml` | ESP32 硬件引脚说明 |

---
